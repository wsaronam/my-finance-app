{% extends 'base.html' %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h2>Dashboard</h2>
<p>Income: {{ income }}</p>
<p>Expenses: {{ expenses }}</p>
<p>Balance: {{ balance }}</p>
<p>Dates: {{ dates }}</p> <!-- delete this later, for debugging -->
<p>Balances: {{ balances }}</p> <!-- delete this later, for debugging -->
<a href="{% url 'add_transaction' %}">Add Transaction</a>


<canvas id="balanceChart" style="width: 100%; height: 400px;"></canvas>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var ctx = document.getElementById('balanceChart').getContext('2d');

        // convert the django variable data into usable JS arrays
        let dates = JSON.parse('{{ dates|escapejs }}');
        let balances = JSON.parse('{{ balances|escapejs }}');

        console.log("Dates:", dates);  // delete this later - for debugging
        console.log("Balances:", balances);  // delete this later - for debugging

        // prevent infinite loading charts
        if (window.balanceChart instanceof Chart) {
            window.balanceChart.destroy();
        }

        
        window.balanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates, // x-axis (dates)
                datasets: [{
                    label: 'Balance Over Time',
                    data: balances, // y-axis (balance)
                    borderColor: 'blue',
                    backgroundColor: 'rgba(0, 0, 255, 0.1)',
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Balance ($)' } }
                }
            }
        });
    });
    
</script>
{% endblock %}